// ------------------------------------------------------------------------------
// <auto-generated>
//     Ce code a été généré par un outil.
//     Version du runtime : 15.0.0.0
//  
//     Les changements apportés à ce fichier peuvent provoquer un comportement incorrect et seront perdues si
//     le code est régénéré.
// </auto-generated>
// ------------------------------------------------------------------------------
namespace Mobioos.Generators.AspNetCore
{
    using System.Linq;
    using System.Text;
    using System.Collections.Generic;
    using Mobioos.Foundation.Jade.Models;
    using Mobioos.Foundation.Jade.Extensions;
    using Mobioos.Scaffold.TextTemplating;
    using Mobioos.Generators.AspNetCore;
    using System;
    
    /// <summary>
    /// Class to produce the template output
    /// </summary>
    
    #line 1 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.VisualStudio.TextTemplating", "15.0.0.0")]
    public partial class Startup : TemplateBase
    {
#line hidden
        /// <summary>
        /// Create the template output
        /// </summary>
        public override string TransformText()
        {
            this.Write("\r\n");
            
            #line 1 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
 var model = (SmartAppInfo)Model; 
            
            #line default
            #line hidden
            this.Write(@"using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using Swashbuckle.AspNetCore.Swagger;
using ");
            
            #line 13 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(model.Id));
            
            #line default
            #line hidden
            this.Write(".Backend.Models;\r\nusing ");
            
            #line 14 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(model.Id));
            
            #line default
            #line hidden
            this.Write(".Backend.Services;\r\nusing ");
            
            #line 15 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(model.Id));
            
            #line default
            #line hidden
            this.Write(".Backend.Infrastructure.Services;\r\nusing ");
            
            #line 16 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(model.Id));
            
            #line default
            #line hidden
            this.Write(".Backend.Repositories;\r\n\r\nnamespace ");
            
            #line 18 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(model.Id));
            
            #line default
            #line hidden
            this.Write(".Backend\r\n{\r\n    public partial class Startup\r\n    {\r\n        public Startup(IHos" +
                    "tingEnvironment env)\r\n        {\r\n            var builder = new ConfigurationBuil" +
                    "der()\r\n                .SetBasePath(env.ContentRootPath)\r\n                .AddJs" +
                    "onFile(\"appsettings.json\", optional: true, reloadOnChange: true)\r\n              " +
                    "  .AddJsonFile($\"appsettings.{env.EnvironmentName}.json\", optional: true);\r\n\r\n  " +
                    "          if (env.IsDevelopment())\r\n            {\r\n                // For more d" +
                    "etails on using the user secret store see https://go.microsoft.com/fwlink/?LinkI" +
                    "D=532709\r\n                builder.AddUserSecrets<Startup>();\r\n            }\r\n\r\n " +
                    "           builder.AddEnvironmentVariables();\r\n            Configuration = build" +
                    "er.Build();\r\n        }\r\n\r\n        public IConfigurationRoot Configuration { get;" +
                    " }\r\n\r\n        // This method gets called by the runtime. Use this method to add " +
                    "services to the container.\r\n        public void ConfigureServices(IServiceCollec" +
                    "tion services)\r\n        {\r\n            // Add framework services.\r\n            s" +
                    "ervices.AddDbContext<ApplicationDbContext>(options =>\r\n                options.U" +
                    "seSqlServer(Configuration.GetConnectionString(\"DefaultConnection\")));\r\n\r\n\t\t\tserv" +
                    "ices.AddCors(options =>\r\n            {\r\n                options.AddPolicy(\"SiteC" +
                    "orsPolicy\",\r\n                builder => builder.AllowAnyOrigin()\r\n              " +
                    "  .AllowAnyMethod()\r\n                .AllowAnyHeader()\r\n                .AllowCr" +
                    "edentials());\r\n            });\r\n\r\n            //Configure authentication service" +
                    "s.\r\n\t\t\tConfigureAuth(services);\r\n\r\n            services.AddMvc();\r\n\r\n           " +
                    " // Add application services.\r\n            services.AddTransient<IEmailSender, A" +
                    "uthMessageSender>();\r\n            services.AddTransient<ISmsSender, AuthMessageS" +
                    "ender>();\r\n\t\t\tservices.AddScoped(typeof(IRepository<>), typeof(Repository<>));\r\n" +
                    "\t\t\t\r\n\t\t\t");
            
            #line 67 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
if(model.DataModel!=null && model.DataModel.Entities!=null && model.DataModel.Entities.FirstOrDefault(e => !e.IsAbstract && !e.IsEnum)!=null){foreach(var entity in model.DataModel.Entities.Where(e => !e.IsAbstract && !e.IsEnum)) { 
            
            #line default
            #line hidden
            this.Write("\t\t\tservices.AddScoped<I");
            
            #line 68 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(entity.Id));
            
            #line default
            #line hidden
            this.Write("Repository, ");
            
            #line 68 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(entity.Id));
            
            #line default
            #line hidden
            this.Write("Repository>();\r\n\t\t\t");
            
            #line 69 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
}
            
            #line default
            #line hidden
            this.Write("\r\n\t\t\t");
            
            #line 71 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
 foreach(var entity in model.DataModel.Entities.Where(e => !e.IsAbstract && !e.IsEnum)) { 
            
            #line default
            #line hidden
            this.Write("\t\t\tservices.AddScoped<I");
            
            #line 72 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(entity.Id));
            
            #line default
            #line hidden
            this.Write("Service, ");
            
            #line 72 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(entity.Id));
            
            #line default
            #line hidden
            this.Write("Service>();\r\n\t\t\t");
            
            #line 73 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
}}
            
            #line default
            #line hidden
            this.Write("\r\n\t\t\t // Register the Swagger generator, defining one or more Swagger documents\r\n" +
                    "            services.AddSwaggerGen(c =>\r\n            {\r\n                c.Swagge" +
                    "rDoc(\"v1\", new Info { Title = \"");
            
            #line 78 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(model.Id));
            
            #line default
            #line hidden
            this.Write(@" API"", Version = ""v1"" });
            });
        }

        // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
        public void Configure(IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory)
        {
            loggerFactory.AddConsole(Configuration.GetSection(""Logging""));
            loggerFactory.AddDebug();

            if (env.IsDevelopment())
            {
                app.UseDeveloperExceptionPage();
                app.UseDatabaseErrorPage();
                app.UseBrowserLink();
            }
            else
            {
                app.UseExceptionHandler(""/Home/Error"");
            }

			app.UseCors(""SiteCorsPolicy"");

            app.UseStaticFiles();

            ConfigureAuth(app);

            app.UseMvc(routes =>
            {
                routes.MapRoute(
                    name: ""default"",
                    template: ""{controller=Home}/{action=Index}/{id?}"");
            });

			 // Enable middleware to serve generated Swagger as a JSON endpoint.
            app.UseSwagger();

            // Enable middleware to serve swagger-ui (HTML, JS, CSS etc.), specifying the Swagger JSON endpoint.
            app.UseSwaggerUI(c =>
            {
                c.SwaggerEndpoint(""/swagger/v1/swagger.json"", """);
            
            #line 118 "D:\DEV\Generators\Mobioos\Common\Templates\Startup.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(model.Id));
            
            #line default
            #line hidden
            this.Write(" API V1\");\r\n            });\r\n        }\r\n    }\r\n}");
            return this.GenerationEnvironment.ToString();
        }
    }
    
    #line default
    #line hidden
}
