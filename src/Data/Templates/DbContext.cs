// ------------------------------------------------------------------------------
// <auto-generated>
//     Ce code a été généré par un outil.
//     Version du runtime : 15.0.0.0
//  
//     Les changements apportés à ce fichier peuvent provoquer un comportement incorrect et seront perdues si
//     le code est régénéré.
// </auto-generated>
// ------------------------------------------------------------------------------
namespace Mobioos.Generators.AspNetCore
{
    using System.Linq;
    using System.Text;
    using System.Collections.Generic;
    using Mobioos.Foundation.Jade.Models;
    using Mobioos.Foundation.Jade.Extensions;
    using Mobioos.Scaffold.TextTemplating;
    using Mobioos.Generators.AspNetCore;
    using System;
    
    /// <summary>
    /// Class to produce the template output
    /// </summary>
    
    #line 1 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.VisualStudio.TextTemplating", "15.0.0.0")]
    public partial class DbContext : TemplateBase
    {
#line hidden
        /// <summary>
        /// Create the template output
        /// </summary>
        public override string TransformText()
        {
            this.Write("\r\n");
            
            #line 1 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
 var model = (SmartAppInfo)Model; 
            
            #line default
            #line hidden
            this.Write("using Microsoft.EntityFrameworkCore;\r\nusing Microsoft.AspNetCore.Identity.EntityF" +
                    "rameworkCore;\r\nusing Microsoft.AspNetCore.Identity;\r\nusing ");
            
            #line 5 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(model.Id));
            
            #line default
            #line hidden
            this.Write(".Backend.DataModels;\r\n\r\nnamespace ");
            
            #line 7 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(model.Id));
            
            #line default
            #line hidden
            this.Write(@".Backend.Models
{
	public partial class ApplicationDbContext : IdentityDbContext<ApplicationUser>
	{
		public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options) : base(options)
		{
		}

		protected override void OnModelCreating(ModelBuilder builder)
		{
			builder.Entity<IdentityUserLogin<string>>().HasKey(e => new { e.UserId });
            builder.Entity<IdentityUserRole<string>>().HasKey(e => new { e.RoleId });
            builder.Entity<IdentityUserToken<string>>().HasKey(e => new { e.UserId });
			");
            
            #line 20 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
 if(model.DataModel != null && model.DataModel.Entities != null){ 
            
            #line default
            #line hidden
            this.Write("\t\t\t\t");
            
            #line 21 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
 foreach(var entity in model.DataModel.Entities) {
					var primaryKey = entity.AllProperties()?.FirstOrDefault(p => p.IsKey);
					if(!entity.IsAbstract && !entity.IsEnum && primaryKey != null) { var lastKey = entity.AllProperties().Where(p=>p.IsKey).LastOrDefault(); 
            
            #line default
            #line hidden
            this.Write("\t\t\tbuilder.Entity<");
            
            #line 24 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(entity.Id));
            
            #line default
            #line hidden
            this.Write(">().HasKey(e => new { ");
            
            #line 24 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
 foreach(var key in entity.AllProperties().Where(p=>p.IsKey)) {
            
            #line default
            #line hidden
            this.Write(" e.");
            
            #line 24 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(key.Id));
            
            #line default
            #line hidden
            this.Write(" ");
            
            #line 24 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
 if (!key.Equals(lastKey)) {
            
            #line default
            #line hidden
            this.Write(",");
            
            #line 24 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
}
            
            #line default
            #line hidden
            this.Write("  ");
            
            #line 24 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
 }
            
            #line default
            #line hidden
            this.Write("});\r\n\t\t\t");
            
            #line 25 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
 } 
			 } 
			}
			
            
            #line default
            #line hidden
            this.Write("\t\t}\r\n\r\n\r\n\t\tprotected override void OnConfiguring(DbContextOptionsBuilder optionsB" +
                    "uilder)\r\n        {\r\n            base.OnConfiguring(optionsBuilder);\r\n        }\r\n" +
                    "\r\n");
            
            #line 37 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
 if(model.DataModel != null && model.DataModel.Entities != null){ 
            
            #line default
            #line hidden
            this.Write("\t\t");
            
            #line 38 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
 foreach(var entity in model.DataModel.Entities) {
		var key = entity.AllProperties()?.FirstOrDefault(p => p.IsKey);
		if(!entity.IsAbstract && !entity.IsEnum && key != null) { 
            
            #line default
            #line hidden
            this.Write("\t\tpublic DbSet<");
            
            #line 41 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(entity.Id));
            
            #line default
            #line hidden
            this.Write("> ");
            
            #line 41 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(entity.Id));
            
            #line default
            #line hidden
            this.Write("s { get; set; }\r\n\t\t");
            
            #line 42 "D:\DEV\Generators\Mobioos\Data\Templates\DbContext.tt"
 } 
		 } 
	    }
		
            
            #line default
            #line hidden
            this.Write("\t\t\r\n\t}\r\n}");
            return this.GenerationEnvironment.ToString();
        }
    }
    
    #line default
    #line hidden
}
